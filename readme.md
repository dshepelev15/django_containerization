## Эволюция контейнеризации Django приложения:

### Этап 1. Запуск джанго приложения через `python manage.py runserver` в контейнере.

Необходимо:
* Установить все зависимости через пакетный менеджер `pip`.
* Описать `Dockerfile` ([описание синтаксиса](https://docs.docker.com/engine/reference/builder/)) и собрать докер образ с помощью команды `docker build -t web_app -f dockerfiles/Dockerfile .`, где аргументы `-t` - имя тега образа, `-f` путь до `Dockerfile`.
* Запустить контейнер на основе собранного на предыдущем шаге образа с помощью команды `docker run --rm -it -p 8000:8000 web_app`. В команде `docker run` ([см. здесь](https://docs.docker.com/engine/reference/commandline/run/)) аргументы `-p` означает открытие порта в контейнере и его соотвествие на хост машине, `--rm` - удаление контейнера после завершения открытой сессии терминала контейнера, `-it` - интерактивный режим запуска контейнера, то есть будут видны логи и запущенные процессы в контейнере, а альтертивой является запуск контейнера в виде демона через аргумент `-d`.
* Открываем браузер на хост машине и переходим на `localhost:8000` и видим запущенное приложение на Django!


---

### Этап 2. Запуск базы данных на примере PostgreSQL. Соединение к ней из веб приложения.

До того, как запускать веб приложение необходимо подготовить контейнер с базой данных, к которой он будет коннектиться.

**Контейнер базы данных**
* В нашем примере мы не будем описывать свой `Dockerfile` для бд, а возьмем уже готовый образ `postgres:12` с [docker hub](https://hub.docker.com/_/postgres). Но до запуска необходимо подготовить .env файл, в котором будут установлены переменные окружения. В данном случае, для этого образа можно прописать следующие переменные:
    * `POSTGRES_DB` - название базы данных
    * `POSTGRES_USER` - имя пользователя
    * `POSTGRES_PASSWORD` - пароль пользователя
* Запустить контейнер базы данных можно через команду `docker run --rm -it --name db --env-file .env -p 5432:5432 -v ${PWD}/pgdata:/var/lib/postgresql/data postgres:12`, где `--name` - аргумент имени контейнера, `--env-file` - путь до файла с переменными окружениями, а `-v` - `volume` - это монтирование папки с данными между хост машиной и контейнером


**Контейнер веб приложения**
* Для того чтобы приконнектиться к контейнеру с базой данных необходимо установить библиотеку `psycopg2`, а также изменить в `settings.py` переменную `DATABASES` с переменными окружения из файла `.env` (не забыть добавить `--env-file` в команду `docker run`)
* Значение переменной `HOST` можно установить по-разному в зависимости от способа линковки контейнеров:
    * Либо через аргумент `--link <container_name>` команды `docker run`. И тогда значение `HOST` будет равно значению `<container_name>`. С помощью такого способа docker добавит в `/etc/hosts` DNS запись, в которой будет указан IP контейнера.
    * Либо явно задать IP контейнера, можно зайти в контейнер бд через команду `docker exec -it <container_name> bash` и узнать его IP-адрес с помощью `cat /etc/hosts`
* Запустить контейнер, например, через команду `docker run --rm -it -p 8000:8000 --link db --env-file .env web_app`
